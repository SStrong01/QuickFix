<script>
document.addEventListener("DOMContentLoaded", function () {
    // Get elements
    const generateBtn = document.getElementById("generateBtn");
    const ideasList = document.getElementById("ideasList");
    const buyNowBtn = document.getElementById("buyNowBtn");

    // Generate AI Ideas
    generateBtn.addEventListener("click", function () {
        let niche = document.getElementById("nicheInput").value.trim();
        let platform = document.getElementById("platformSelect").value;

        if (niche === "") {
            alert("Please enter a niche.");
            return;
        }

        // Send request to backend
        fetch("/generate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json" // ✅ Fix: Correct Content-Type
            },
            body: JSON.stringify({ niche: niche, platform: platform }) // ✅ Fix: Send JSON data
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                ideasList.innerHTML = "";
                data.ideas.forEach(idea => {
                    let li = document.createElement("li");
                    li.innerHTML = `<span>🔥</span> ${idea}`;
                    ideasList.appendChild(li);
                });
            } else {
                alert("❌ Error: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("❌ Error generating AI ideas.");
        });
    });

    // Handle Stripe Payment
    buyNowBtn.addEventListener("click", function () {
        let niche = document.getElementById("nicheInput").value.trim();
        let platform = document.getElementById("platformSelect").value;

        if (niche === "") {
            alert("Please enter a niche before purchasing.");
            return;
        }

        fetch("/create-checkout-session", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ niche: niche, platform: platform })
        })
        .then(response => response.json())
        .then(data => {
            if (data.url) {
                window.location.href = data.url; // Redirect to Stripe checkout
            } else {
                alert("❌ Error creating checkout session.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("❌ Error processing payment.");
        });
    });
});
</script>